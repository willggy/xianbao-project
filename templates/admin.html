<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¿æŠ¥èšåˆ - ç®¡ç†æ§åˆ¶å°</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons (å›¾æ ‡åº“) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    
    <style>
        :root { --primary-bg: #f3f4f6; --card-border: #eaecf0; }
        body { background-color: var(--primary-bg); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; padding-bottom: 40px; }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .admin-header { background: #fff; border-bottom: 1px solid #ddd; padding: 15px 0; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        
        /* å¡ç‰‡é€šç”¨æ ·å¼ */
        .card { border: 1px solid var(--card-border); border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: none; margin-bottom: 24px; }
        .card-header { background: #fff; border-bottom: 1px solid var(--card-border); padding: 20px 24px; border-radius: 12px 12px 0 0 !important; font-weight: 700; font-size: 1.1rem; display: flex; align-items: center; justify-content: space-between; }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stat-card { transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-3px); }
        .stat-icon { width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-right: 15px; }
        
        /* è§„åˆ™æ ‡ç­¾ */
        .badge-rule { padding: 8px 12px; font-weight: 500; letter-spacing: 0.5px; border: 1px solid #e0e0e0; border-radius: 6px; display: inline-flex; align-items: center; background: #fff; color: #333; }
        .badge-rule .tag-icon { margin-right: 6px; font-size: 12px; opacity: 0.7; }
        .badge-rule .btn-del { margin-left: 8px; cursor: pointer; color: #999; transition: color 0.2s; }
        .badge-rule .btn-del:hover { color: #dc3545; }

        /* è¡¨æ ¼æ ·å¼ */
        .table-custom thead th { background-color: #f8f9fa; border-bottom: 2px solid #eaecf0; color: #666; font-weight: 600; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 0.5px; padding: 12px 16px; }
        .table-custom tbody td { vertical-align: middle; padding: 16px; border-bottom: 1px solid #eaecf0; }
        .table-custom tr:last-child td { border-bottom: none; }
        
        /* æŒ‰é’®ç¾åŒ– */
        .btn-icon { display: inline-flex; align-items: center; gap: 6px; }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .stat-card { margin-bottom: 15px; }
        }
    </style>
</head>
<body>

<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
<header class="admin-header">
    <div class="container d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
            <i class="bi bi-speedometer2 text-primary fs-4 me-2"></i>
            <h4 class="mb-0 fw-bold text-dark">ç®¡ç†æ§åˆ¶å°</h4>
        </div>
        <div class="d-flex gap-2">
            <a href="/" class="btn btn-outline-secondary btn-sm btn-icon">
                <i class="bi bi-house"></i> è¿”å›é¦–é¡µ
            </a>
            <a href="/logout" class="btn btn-danger btn-sm btn-icon">
                <i class="bi bi-box-arrow-right"></i> é€€å‡º
            </a>
        </div>
    </div>
</header>

<div class="container">
    
    <!-- 1. ç³»ç»Ÿæ¦‚è§ˆé¢æ¿ -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card stat-card p-3">
                <div class="d-flex align-items-center">
                    <div class="stat-icon bg-primary bg-opacity-10 text-primary">
                        <i class="bi bi-database-check"></i>
                    </div>
                    <div>
                        <div class="text-muted small fw-bold">æ•°æ®æ€»æ•°</div>
                        <h3 class="mb-0 fw-bold">{{ stats.total_articles }}</h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card stat-card p-3">
                <div class="d-flex align-items-center">
                    <div class="stat-icon bg-success bg-opacity-10 text-success">
                        <i class="bi bi-people"></i>
                    </div>
                    <div>
                        <div class="text-muted small fw-bold">ç´¯è®¡è®¿é—®</div>
                        <h3 class="mb-0 fw-bold">{{ stats.total_visits }}</h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card stat-card p-3">
                <div class="d-flex align-items-center justify-content-between w-100">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon bg-warning bg-opacity-10 text-warning">
                            <i class="bi bi-clock-history"></i>
                        </div>
                        <div>
                            <div class="text-muted small fw-bold">ä¸Šæ¬¡æŠ“å–</div>
                            <div class="fw-bold text-truncate" style="max-width: 120px;" title="{{ stats.last_update }}">
                                {{ stats.last_update.split(' ')[1] if ' ' in stats.last_update else 'åˆšåˆš' }}
                            </div>
                        </div>
                    </div>
                    <!-- æ‰‹åŠ¨æŠ“å–æŒ‰é’® -->
                    <a href="/api/scrape_now" class="btn btn-sm btn-primary btn-icon shadow-sm">
                        <i class="bi bi-arrow-clockwise"></i> ç«‹å³æ›´æ–°
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- 2. è§„åˆ™é…ç½®ä¸­å¿ƒ (ä½¿ç”¨ Tabs åˆ‡æ¢ï¼Œè§£å†³æ‚ä¹±é—®é¢˜) -->
        <div class="col-lg-12 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <span><i class="bi bi-gear-wide-connected me-2"></i>é‡‡é›†è§„åˆ™é…ç½®</span>
                </div>
                <div class="card-body">
                    <!-- é€‰é¡¹å¡å¯¼èˆª -->
                    <ul class="nav nav-tabs nav-fill mb-4" id="ruleTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active fw-bold" id="white-tab" data-bs-toggle="tab" data-bs-target="#white-content" type="button">
                                <i class="bi bi-check-circle-fill text-success me-2"></i>é‡‡é›†ç™½åå•
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link fw-bold" id="black-tab" data-bs-toggle="tab" data-bs-target="#black-content" type="button">
                                <i class="bi bi-x-circle-fill text-danger me-2"></i>å±è”½é»‘åå•
                            </button>
                        </li>
                    </ul>

                    <!-- é€‰é¡¹å¡å†…å®¹ -->
                    <div class="tab-content" id="ruleTabsContent">
                        
                        <!-- ç™½åå•é¢æ¿ -->
                        <div class="tab-pane fade show active" id="white-content">
                            <form action="/api/rule" method="POST" class="row g-2 mb-4 align-items-center bg-light p-3 rounded">
                                <input type="hidden" name="action" value="add">
                                <input type="hidden" name="type" value="white">
                                <div class="col-auto">
                                    <span class="fw-bold text-success"><i class="bi bi-plus-lg"></i> æ–°å¢è§„åˆ™:</span>
                                </div>
                                <div class="col-auto">
                                    <select name="scope" class="form-select form-select-sm border-success">
                                        <option value="title">ğŸ“ åŒ¹é…æ ‡é¢˜</option>
                                        <option value="url">ğŸ”— åŒ¹é…ç½‘å€</option>
                                    </select>
                                </div>
                                <div class="col">
                                    <input type="text" name="keyword" class="form-control form-control-sm" placeholder="è¾“å…¥å…³é”®è¯ (å¦‚: çº¢åŒ… / vip)..." required>
                                </div>
                                <div class="col-auto">
                                    <button class="btn btn-success btn-sm px-3" type="submit">æ·»åŠ </button>
                                </div>
                            </form>

                            <div class="d-flex flex-wrap gap-2">
                                {% for item in whitelist %}
                                <div class="badge-rule">
                                    {% if item['match_scope'] == 'url' %}
                                        <span class="tag-icon text-primary bg-primary bg-opacity-10 px-1 rounded">URL</span>
                                    {% else %}
                                        <span class="tag-icon text-secondary bg-secondary bg-opacity-10 px-1 rounded">æ ‡é¢˜</span>
                                    {% endif %}
                                    {{ item['keyword'] }}
                                    <form action="/api/rule" method="POST" class="d-inline">
                                        <input type="hidden" name="action" value="delete">
                                        <input type="hidden" name="id" value="{{ item['id'] }}">
                                        <i class="bi bi-x-lg btn-del" onclick="this.parentNode.submit()" title="åˆ é™¤"></i>
                                    </form>
                                </div>
                                {% else %}
                                <div class="text-muted small fst-italic p-2">æš‚æ— ç™½åå•è§„åˆ™ï¼Œå°†ä»…é‡‡é›†é“¶è¡Œå…³é”®è¯ã€‚</div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- é»‘åå•é¢æ¿ -->
                        <div class="tab-pane fade" id="black-content">
                            <form action="/api/rule" method="POST" class="row g-2 mb-4 align-items-center bg-light p-3 rounded">
                                <input type="hidden" name="action" value="add">
                                <input type="hidden" name="type" value="black">
                                <div class="col-auto">
                                    <span class="fw-bold text-danger"><i class="bi bi-plus-lg"></i> æ–°å¢å±è”½:</span>
                                </div>
                                <div class="col-auto">
                                    <select name="scope" class="form-select form-select-sm border-danger">
                                        <option value="title">ğŸ“ åŒ¹é…æ ‡é¢˜</option>
                                        <option value="url">ğŸ”— åŒ¹é…ç½‘å€</option>
                                    </select>
                                </div>
                                <div class="col">
                                    <input type="text" name="keyword" class="form-control form-control-sm" placeholder="è¾“å…¥å±è”½è¯ (å¦‚: è´·æ¬¾ / ads)..." required>
                                </div>
                                <div class="col-auto">
                                    <button class="btn btn-danger btn-sm px-3" type="submit">æ·»åŠ </button>
                                </div>
                            </form>

                            <div class="d-flex flex-wrap gap-2">
                                {% for item in blacklist %}
                                <div class="badge-rule">
                                    {% if item['match_scope'] == 'url' %}
                                        <span class="tag-icon text-danger bg-danger bg-opacity-10 px-1 rounded">URL</span>
                                    {% else %}
                                        <span class="tag-icon text-secondary bg-secondary bg-opacity-10 px-1 rounded">æ ‡é¢˜</span>
                                    {% endif %}
                                    {{ item['keyword'] }}
                                    <form action="/api/rule" method="POST" class="d-inline">
                                        <input type="hidden" name="action" value="delete">
                                        <input type="hidden" name="id" value="{{ item['id'] }}">
                                        <i class="bi bi-x-lg btn-del" onclick="this.parentNode.submit()" title="åˆ é™¤"></i>
                                    </form>
                                </div>
                                {% else %}
                                <div class="text-muted small fst-italic p-2">æš‚æ— é»‘åå•è§„åˆ™ã€‚</div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. æ–‡ç« å†…å®¹ç®¡ç† -->
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-file-earmark-text me-2"></i>
                        <span>å†…å®¹ç®¡ç† (æˆ‘å‘å¸ƒçš„)</span>
                    </div>
                    <a href="/publish" class="btn btn-success btn-sm btn-icon">
                        <i class="bi bi-pencil-square"></i> å‘å¸ƒæ–°çº¿æŠ¥
                    </a>
                </div>
                <div class="table-responsive">
                    <table class="table table-custom table-hover mb-0">
                        <thead>
                            <tr>
                                <th style="width: 50%;">æ–‡ç« æ ‡é¢˜</th>
                                <th style="width: 15%;">çŠ¶æ€</th>
                                <th style="width: 15%;">æ›´æ–°æ—¶é—´</th>
                                <th style="width: 20%; text-align: right;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for art in my_articles %}
                            <tr>
                                <td>
                                    <a href="/view?id={{ art['id'] }}" target="_blank" class="text-decoration-none fw-bold text-dark">
                                        {{ art['title'] }}
                                    </a>
                                </td>
                                <td>
                                    {% if art['is_top'] %}
                                    <span class="badge bg-danger bg-opacity-10 text-danger border border-danger">
                                        <i class="bi bi-fire me-1"></i>ç½®é¡¶
                                    </span>
                                    {% else %}
                                    <span class="badge bg-secondary bg-opacity-10 text-secondary border">
                                        æ™®é€š
                                    </span>
                                    {% endif %}
                                </td>
                                <td class="text-muted small">{{ art['updated_at'].split(' ')[0] }}</td>
                                <td class="text-end">
                                    <a href="/article/edit/{{ art['id'] }}" class="btn btn-outline-primary btn-sm me-1" title="ç¼–è¾‘">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <a href="/article/delete/{{ art['id'] }}" class="btn btn-outline-danger btn-sm" onclick="return confirm('ç¡®è®¤è¦æ°¸ä¹…åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿ');" title="åˆ é™¤">
                                        <i class="bi bi-trash"></i>
                                    </a>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="4" class="text-center py-5 text-muted bg-light">
                                    <div class="d-flex flex-column align-items-center">
                                        <i class="bi bi-inbox fs-1 mb-2 opacity-50"></i>
                                        <span>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡ä»»ä½•å†…å®¹</span>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="col-12 text-center mt-3">
             <a href="/logs" class="text-decoration-none text-muted small">
                 <i class="bi bi-terminal me-1"></i>æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œæ—¥å¿—
             </a>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>